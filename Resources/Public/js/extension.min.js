
$(function(){var d=$("img#cropbox").imgAreaSelect({x1:imgX1,y1:imgY1,x2:imgX2,y2:imgY2,imageWidth:imgWidth,imageHeight:imgHeight,aspectRatio:"imgAr",handles:true,keys:true,fadeSpeed:200,onInit:c,onSelectChange:c,persistent:true,instance:true});$("#edit").on("keyup","#x1, #y1, #x2, #y2",function(){d.setSelection($("#edit #x1").val(),$("#edit #y1").val(),$("#edit #x2").val(),$("#edit #y2").val(),true);d.update();c("",d.getSelection())});$("#edit").on("change","#aspectRatio",function(){d.setOptions({aspectRatio:$("#aspectRatio").val(),movable:false});if($("#aspectRatio").val()){$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").attr("readonly","readonly")}else{$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").removeAttr("readonly")}$(".imgareaselect-selection").css("background","#900")});$("#controller").on("click","#reset",function(){d.setSelection(b.x1,b.y1,b.x2,b.y2);d.update();a()});$("#controller").on("click","#save",function(){$.ajax({dataType:"json",url:"ajax.php?ajaxID=TkcropthumbsAjaxController::init",data:{action:"save",cropValues:d.getSelection(),uid:imgUid}}).success(function(e){if(e){parent.window.opener.focus();parent.close()}})});$("#controller").on("click","#close",function(){parent.window.opener.focus();parent.close()});$("#controller").on("click","#delete",function(){$.ajax({dataType:"json",url:"ajax.php?ajaxID=TkcropthumbsAjaxController::init",data:{action:"delete",uid:imgUid}}).success(function(e){if(e){parent.window.opener.focus();parent.close()}})});function c(e,f){$("#x1").val(f.x1);$("#y1").val(f.y1);$("#x2").val(f.x2);$("#y2").val(f.y2);$("#w").val(f.width);$("#h").val(f.height);$(".imgareaselect-selection").css("background","none");d.setOptions({movable:true});d.update();a()}var b=d.getSelection();function a(){var e=d.getSelection();var f=JSON.stringify(b)===JSON.stringify(e);if(f==false){$("#controller #close").hide();$("#controller #save").show()}else{$("#controller #close").show();$("#controller #save").hide()}if($("#edit #aspectRatio").val()==0){$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").removeAttr("readonly")}}});