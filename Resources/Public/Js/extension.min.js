$(function(){var d=$("img#cropbox").imgAreaSelect({x1:imgX1,y1:imgY1,x2:imgX2,y2:imgY2,imageWidth:imgWidth,imageHeight:imgHeight,aspectRatio:imgAr,handles:true,keys:true,fadeSpeed:200,onInit:c,onSelectChange:c,persistent:true,instance:true});$("#edit").on("keyup","#x1, #y1, #x2, #y2",function(){d.setSelection($("#edit #x1").val(),$("#edit #y1").val(),$("#edit #x2").val(),$("#edit #y2").val(),true);d.update();c("",d.getSelection())});$("#edit").on("change","#aspectRatio",function(){d.setOptions({aspectRatio:$("#aspectRatio").val(),movable:false});if($("#aspectRatio").val()){$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").attr("readonly","readonly")}else{$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").removeAttr("readonly")}$(".imgareaselect-selection").css("background","#900")});$("#controller").on("click","#reset",function(){location.reload()});$("#controller").on("click","#save",function(){$.ajax({dataType:"json",url:ajaxUrl,data:{action:"save",cropValues:JSON.stringify(d.getSelection()),uid:imgUid}}).success(function(f){if(f){parent.window.opener.focus();parent.close()}})});$("#controller").on("click","#close",function(){parent.window.opener.focus();parent.close()});$("#controller").on("click","#delete",function(){$.ajax({dataType:"json",url:ajaxUrl,data:{action:"delete",uid:imgUid}}).success(function(f){if(f){parent.window.opener.focus();parent.close()}})});function c(f,g){$("#x1").val(g.x1);$("#y1").val(g.y1);$("#x2").val(g.x2);$("#y2").val(g.y2);$("#w").val(g.width);$("#h").val(g.height);$(".imgareaselect-selection").css("background","none");d.setOptions({movable:true});d.update();a()}var b=d.getSelection();function a(){var f=d.getSelection();var g=JSON.stringify(b)===JSON.stringify(f);if(g==false){$("#controller #close").hide();$("#controller #save").show()}else{$("#controller #close").show();$("#controller #save").hide()}if($("#edit #aspectRatio").val()==0){$("#edit #x1, #edit #y1, #edit #x2, #edit #y2").removeAttr("readonly")}}function e(){return !!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}if(!e()){$('img[src$="svg"]').attr("src",function(){return $(this).attr("src").replace(".svg",".png")});$("div, span").each(function(){var f=$(this).css("background-image");if(f.indexOf(".svg")>0){$(this).css("background-image",f.replace(".svg",".png"))}})}});